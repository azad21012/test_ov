(this["webpackJsonpopenvidu-insecure-react"]=this["webpackJsonpopenvidu-insecure-react"]||[]).push([[0],{100:function(e,n,t){"use strict";t.r(n);var a=t(0),i=t.n(a),o=t(49),s=t.n(o),r=(t(57),t(8)),c=t(9),l=t(4),u=t(11),d=t(10),m=t(24),h=t.n(m),v=t(50),f=(t(97),function(e){Object(u.a)(t,e);var n=Object(d.a)(t);function t(e){var a;return Object(r.a)(this,t),(a=n.call(this,e)).videoRef=i.a.createRef(),a}return Object(c.a)(t,[{key:"componentDidUpdate",value:function(e){e&&this.videoRef&&this.props.streamManager.addVideoElement(this.videoRef.current)}},{key:"componentDidMount",value:function(){this.props&&this.videoRef&&this.props.streamManager.addVideoElement(this.videoRef.current)}},{key:"render",value:function(){return i.a.createElement("video",{autoPlay:!0,ref:this.videoRef})}}]),t}(a.Component)),p=(t(98),function(e){Object(u.a)(t,e);var n=Object(d.a)(t);function t(){return Object(r.a)(this,t),n.apply(this,arguments)}return Object(c.a)(t,[{key:"getNicknameTag",value:function(){return JSON.parse(this.props.streamManager.stream.connection.data).clientData}},{key:"render",value:function(){return i.a.createElement("div",null,void 0!==this.props.streamManager?i.a.createElement("div",{className:"streamcomponent"},i.a.createElement(f,{streamManager:this.props.streamManager}),i.a.createElement("div",null,i.a.createElement("p",null,this.getNicknameTag()))):null)}}]),t}(a.Component)),g=t(51),b=t.n(g),S="https://ok-vhxcrdgqszi5gghu3snu.atlms.ir",k=function(e){Object(u.a)(t,e);var n=Object(d.a)(t);function t(e){var a;return Object(r.a)(this,t),(a=n.call(this,e)).state={mySessionId:"SessionA",myUserName:"Participant"+Math.floor(100*Math.random()),session:void 0,mainStreamManager:void 0,publisher:void 0,subscribers:[],adminStream:void 0,token:void 0},a.joinSession=a.joinSession.bind(Object(l.a)(a)),a.leaveSession=a.leaveSession.bind(Object(l.a)(a)),a.handleChangeSessionId=a.handleChangeSessionId.bind(Object(l.a)(a)),a.handleChangeUserName=a.handleChangeUserName.bind(Object(l.a)(a)),a.handleMainVideoStream=a.handleMainVideoStream.bind(Object(l.a)(a)),a.onbeforeunload=a.onbeforeunload.bind(Object(l.a)(a)),a}return Object(c.a)(t,[{key:"getNicknameTag",value:function(e){return console.log("adminov",e),JSON.parse(e.stream.connection.data).clientData}},{key:"checkAdminStream",value:function(e){return"admin"===this.getNicknameTag(e).toLowerCase()?e:void 0}},{key:"componentDidMount",value:function(){window.addEventListener("beforeunload",this.onbeforeunload)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("beforeunload",this.onbeforeunload)}},{key:"onbeforeunload",value:function(e){this.leaveSession()}},{key:"handleChangeSessionId",value:function(e){this.setState({mySessionId:e.target.value})}},{key:"handleChangeUserName",value:function(e){this.setState({myUserName:e.target.value})}},{key:"handleMainVideoStream",value:function(e){this.state.mainStreamManager!==e&&this.setState({mainStreamManager:e})}},{key:"deleteSubscriber",value:function(e){var n=this.state.subscribers,t=b.a.findIndex(n,(function(n){return n.connection.connectionId==e.connection.connectionId}));t>-1&&(n.splice(t,1),this.setState({subscribers:n}))}},{key:"joinSession",value:function(){var e=this;this.OV=new v.OpenVidu,this.setState({session:this.OV.initSession()},(function(){var n=e.state.session;n.on("streamCreated",(function(t){var a=n.subscribe(t.stream,void 0);e.checkAdminStream(a)&&e.setState({adminStream:e.checkAdminStream(a)})})),n.on("connectionCreated",(function(n){console.log("connectionCreatedaa");var t=n,a=e.state.subscribers;a.push(t),e.setState({subscribers:a})})),n.on("connectionDestroyed",(function(n){e.deleteSubscriber(n)})),e.getToken().then((function(t){n.connect(t,{clientData:e.state.myUserName}).then((function(){var a=e.OV.initPublisher(void 0,{audioSource:void 0,videoSource:void 0,publishAudio:!0,publishVideo:!0,resolution:"640x480",frameRate:30,insertMode:"APPEND",mirror:!1});n.publish(a),e.setState({publisher:a,token:t}),e.checkAdminStream(a)&&e.setState({adminStream:a})})).catch((function(e){console.log("There was an error connecting to the session:",e.code,e.message)}))}))}))}},{key:"leaveSession",value:function(){var e=this.state.session;e&&e.disconnect(),this.OV=null,this.setState({session:void 0,subscribers:[],mySessionId:"SessionA",myUserName:"Participant"+Math.floor(100*Math.random()),mainStreamManager:void 0,publisher:void 0})}},{key:"render",value:function(){var e=this.state.mySessionId,n=this.state.myUserName;return i.a.createElement("div",{className:"container"},void 0===this.state.session?i.a.createElement("div",{id:"join"},i.a.createElement("div",{id:"img-div"},i.a.createElement("img",{src:"resources/images/openvidu_grey_bg_transp_cropped.png",alt:"OpenVidu logo"})),i.a.createElement("div",{id:"join-dialog",className:"jumbotron vertical-center"},i.a.createElement("h1",null," Join a video session "),i.a.createElement("form",{className:"form-group",onSubmit:this.joinSession},i.a.createElement("p",null,i.a.createElement("label",null,"Participant: "),i.a.createElement("input",{className:"form-control",type:"text",id:"userName",value:n,onChange:this.handleChangeUserName,required:!0})),i.a.createElement("p",null,i.a.createElement("label",null," Session: "),i.a.createElement("input",{className:"form-control",type:"text",id:"sessionId",value:e,onChange:this.handleChangeSessionId,required:!0})),i.a.createElement("p",{className:"text-center"},i.a.createElement("input",{className:"btn btn-lg btn-success",name:"commit",type:"submit",value:"JOIN"}))))):null,void 0!==this.state.session?i.a.createElement("div",{id:"session"},i.a.createElement("div",{id:"session-header"},i.a.createElement("h1",{id:"session-title"},e),this.state.token&&i.a.createElement("div",null,"Your token:",this.state.token),i.a.createElement("input",{className:"btn btn-large btn-danger",type:"button",id:"buttonLeaveSession",onClick:this.leaveSession,value:"Leave session"})),void 0!==this.state.adminStream?i.a.createElement("div",{id:"main-video",className:"col-md-10"},i.a.createElement(p,{streamManager:this.state.adminStream})):null,i.a.createElement("div",{id:"video-container",className:"col-md-2"},i.a.createElement("h4",null,"Remote Users"),i.a.createElement("div",null,"Counts: ",this.state.subscribers.length))):null)}},{key:"getToken",value:function(){var e=this;return this.createSession(this.state.mySessionId).then((function(n){return e.createToken(n)}))}},{key:"createSession",value:function(e){return new Promise((function(n,t){var a=JSON.stringify({customSessionId:e});h.a.post(S+"/openvidu/api/sessions",a,{headers:{Authorization:"Basic "+btoa("OPENVIDUAPP:kJmYENudQ1zAsIZ"),"Content-Type":"application/json"}}).then((function(e){console.log("CREATE SESION",e),n(e.data.id)})).catch((function(t){var a=Object.assign({},t);409===a.response.status?n(e):(console.log(a),console.warn("No connection to OpenVidu Server. This may be a certificate error at "+S),window.confirm('No connection to OpenVidu Server. This may be a certificate error at "'+S+'"\n\nClick OK to navigate and accept it. If no certificate warning is shown, then check that your OpenVidu Server is up and running at "'+S+'"')&&window.location.assign(S+"/accept-certificate"))}))}))}},{key:"createToken",value:function(e){return new Promise((function(n,t){h.a.post(S+"/openvidu/api/sessions/"+e+"/connection",{},{headers:{Authorization:"Basic "+btoa("OPENVIDUAPP:kJmYENudQ1zAsIZ"),"Content-Type":"application/json"}}).then((function(e){console.log("TOKEN",e),n(e.data.token)})).catch((function(e){return t(e)}))}))}}]),t}(a.Component),y=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function E(e){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var n=e.installing;n.onstatechange=function(){"installed"===n.state&&(navigator.serviceWorker.controller?console.log("New content is available; please refresh."):console.log("Content is cached for offline use."))}}})).catch((function(e){console.error("Error during service worker registration:",e)}))}s.a.render(i.a.createElement(k,null),document.getElementById("root")),function(){if("serviceWorker"in navigator){if(new URL("",window.location).origin!==window.location.origin)return;window.addEventListener("load",(function(){var e="".concat("","/service-worker.js");y?(!function(e){fetch(e).then((function(n){404===n.status||-1===n.headers.get("content-type").indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):E(e)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(e),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://goo.gl/SC7cgQ")}))):E(e)}))}}()},52:function(e,n,t){e.exports=t(100)},57:function(e,n,t){},97:function(e,n,t){},98:function(e,n,t){}},[[52,1,2]]]);
//# sourceMappingURL=main.bee18f05.chunk.js.map